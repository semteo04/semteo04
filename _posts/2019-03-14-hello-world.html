---
layout : post
---
<html>
<head>
    <title>31</title>
</head>
<body>
    <canvas id="can" height="600" width="600"></canvas>
    <textarea id="num"></textarea>
    <button onclick="gen()">gen!</button>
    <button onclick="what()">what!</button>
    <script>
        var c = document.getElementById("can");
        var ctx = c.getContext("2d");
        var peocnt=200;
        function node(){
        	this.win=0;
        	this.b=new Array(96);
        	this.new=function(){
        		var i;
        		for(i=0;i<96;i++) this.b[i]=Math.random()*2-1;
        	}
        }
        var peo;
        function init(){
        	peo=new Array(peocnt);
        	var i;
        	for(i=0;i<peocnt;i++) {peo[i]=new node(); peo[i].new();}
        }
    	init();
    	function paint(){
    		ctx.beginPath();
    		ctx.rect(0,0,600,600);
    		ctx.fillStyle="white";
    		ctx.fill();
    		ctx.closePath();
    		for(i=0;i<=31;i++){
    			ctx.beginPath();
    			ctx.arc(100,50+i*15,5,0,2*Math.PI);
    			ctx.fill();
    			ctx.closePath();
    		}
    		ctx.beginPath();
    		ctx.arc(500,150,5,0,2*Math.PI);
    		ctx.fill();
    		ctx.closePath();
    		ctx.beginPath();
    		ctx.arc(500,300,5,0,2*Math.PI);
    		ctx.fill();
    		ctx.closePath();
    		ctx.beginPath();
    		ctx.arc(500,450,5,0,2*Math.PI);
    		ctx.fill();
    		ctx.closePath();
    		for(i=0;i<96;i++){
    			ctx.beginPath();
    			ctx.moveTo(100,i%32*15+50);
    			ctx.lineTo(500,parseInt(i/32+1)*150);
    			if(peo[1].b[i]>0) ctx.strokeStyle="rgb(0,0," + (peo[1].b[i]*255) + ")";
    			else ctx.strokeStyle="rgb(" + (peo[1].b[i]*255*-1) + ",0,0)";
    			ctx.stroke();
    			ctx.closePath();
    		}
    	}
    	function what(){
    		var i;
    		for(i=0;i<=31;i++){
    			console.log(say(0,i));
    		}
    	}
    	function gen(){
    		var count=parseInt(document.getElementById("num").value);
    		var i,j,k;
    		for(k=1;k<=count;k++){
    			for(i=0;i<peocnt;i++){
    				peo[i].win=0;
    				for(j=0;j<peocnt;j++){
    					if(i==j) continue;
    					fight(i,j);
	    			}
    			}
    			for(i=0;i<peocnt;i++){
    				var x=-1,y,t;
    				for(j=i;j<peocnt;j++){
	    				if(x<peo[j].win){ x=peo[j].win; y=j;}
    				}
    				t=peo[i];
    				peo[i]=peo[y];
	    			peo[y]=t;
    			}
    			paint();
	    		for(i=100;i<peocnt;i++) peo[i].new();
	    		for(i=10;i<=50;i++){
	    			x=parseInt(Math.random()*10+1);
	    			y=parseInt(Math.random()*10+1);
	    			for(var j=0;j<96;j++) {if(Math.random()*2>=1)peo[i].b[j]=peo[x].b[j]; else peo[i].b[j]=peo[y].b[j];}
	    		}
	    		for(i=50;i<=100;i++){
	    			x=parseInt(Math.random()*10+1);
	    			for(var j=0;j<96;j++) {if(Math.random()*2>=1)peo[i].b[j]=peo[x].b[j]; else peo[i].b[j]=peo[x].b[j]*-1;}
	    		}
    		}
    	}
    	function fight(x,y){
    		var rock=31;
    		while(true){
    			var xx=say(x,rock);
    			rock-=xx;
    			if(rock<=0){peo[x].win++; break;}
    			var xx=say(y,rock);
    			rock-=xx;
    			if(rock<=0) break;
    		}
    	}
    	function say(x,y){
    		var a=peo[x].b[y],b=peo[x].b[y+32],c=peo[x].b[y+64];
    		if(a>b){
    			if(a>c) return 1; else return 3;
    		}
    		else{
    			if(b>c) return 2; else return 3;
    		}
    	}
    </script>
</body>
</html>